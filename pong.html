<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pong</title>

    <link rel="stylesheet" href="pongs.css">
    <style>
        * { padding: 0; margin: 0; }
        canvas { background: greenyellow; display: block; margin: 0 auto; }
       
        h2 {
            margin-bottom: 100px;
            color:white;
        }

        #winnerMessage {
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="espacio"><h2>PONG GAME</h2></div>
    <canvas id="myCanvas" width="480" height="320"></canvas>
    <button id="stopButton">STOP</button>
    <button id="restartButton">START</button> <!-- Nuevo botón de reinicio -->
    <div id="winnerMessage"></div>
    <div id="scoreBoard"></div> <!-- Nuevo elemento para mostrar el puntaje final -->
</body>
<script>
    let canvas = document.getElementById("myCanvas");
    let ctx = canvas.getContext("2d");
    let x = 240;
    let y = 170;
    let dy = 2;
    let dx = 1;
    let raquetx = 460; 
    let raquety = 110;
    let raquetx2 = 10;
    let raquety2 = 120;
    let raquetx3 = 80;
    let raquety3 = 270;
    let raquetx4 = 390;
    let raquety4 = 270;
     let raquetx5 = 87;
    let raquety5 = 265;
    let raquetx6 = 390;
    let raquety6 = 265;
    let raquetx7 = 105;
    let raquety7 = 270;
    let raquetx8 = 90;
    let raquety8 = 290;
    let raquetx9 = 405;
    let raquety9 = 285;
    let raquetx10 = 395;
    let raquety10= 300;
    let raquetx11 = 410;
    let raquety11 = 290;
    let downPressed = false;
    let stopDrawing = false;
    let upPressed = false;
    let down2 = false;
    let up2 = false;
    let puntosP1 = 0;
    let puntosP2 = 0;
    let maxPoints = 3; // Límite de puntos para ganar el juego
    
    //un Listener de eventos Callback: pasa una funcion como parametro a otra
    document.addEventListener("keydown", keyDownHandler, false);
    document.addEventListener("keyup", keyUpHandler, false);

    function keyDownHandler(e) {
        //alert(e.keycode);
        if (e.keyCode == 40) {
            downPressed = true;
        }
        if (e.keyCode == 38) {
            upPressed = true;
        }
        if (e.keyCode == 87) {
            down2 = true;
        }
        if (e.keyCode == 83) {
            up2 = true;
        }
    }

    function keyUpHandler(e) {
        //alert(e.keycode);
        if (e.keyCode == 40) {
            downPressed = false;
        }
        if (e.keyCode == 38) {
            upPressed = false;
        }
        if (e.keyCode == 87) {
            down2 = false;
        }
        if (e.keyCode == 83) {
            up2 = false;
        }
    }

    //Dibujar la pelota
    function drawBall() {
        ctx.beginPath();
        ctx.arc(x, y, 10, 0, Math.PI * 2);
        ctx.fillStyle = "red";
        ctx.fill();
        ctx.closePath();
    }

    //Dibujar la Raqueta
    function drawRaquet() {
        ctx.beginPath();
        ctx.rect(raquetx2, raquety2, 15, 70); //raqueta izquierda
        ctx.rect(raquetx, raquety, 15, 70); //lado derecho
        ctx.rect(raquetx3, raquety3, 10, 40); //raqueta izquierda
        ctx.rect(raquetx4, raquety4, 10, 40); //raqueta izquierda
        ctx.fillStyle = "orange";
        ctx.fill();
        ctx.closePath();
        
    }

    
    //Dibujar la Raqueta
    function drawRaquet2() {
        ctx.beginPath();
        ctx.rect(raquetx5, raquety5, 20, 10); //raqueta izquierda
        ctx.rect(raquetx6, raquety6, 30, 10); //raqueta izquierda
        ctx.rect(raquetx7, raquety7, 10, 40); //raqueta izquierda
        ctx.rect(raquetx8, raquety8, 25, 10); //raqueta izquierda
        ctx.rect(raquetx9, raquety9, 15, 10); //raqueta izquierda
        ctx.rect(raquetx10, raquety10, 20, 10); //raqueta izquierda
        ctx.rect(raquetx11, raquety11, 10, 25); //raqueta izquierda
        ctx.fillStyle = "orange";
        ctx.fill();
        ctx.closePath();
        
    }
    
    function colitions() {
        let distancex = (raquetx ) - x;
        if (distancex < 0){
            distancex = -distancex;
        }
        let distancey = raquety - y;
        if (distancex < 7 && distancey < 10){
            dx = -dx;
        }
        
        //colicion con raqueta izquierda
        let distancex2 = (raquetx2) - x;
        if (distancex2 < 0){
            distancex2 = -distancex2;
        }
        let distancey2 = raquety2 - y;
        if (distancex2 < 25 && distancey2 < 10){
            dx = -dx;
        }
        
        let distancex3 = (raquetx3 ) - x;
        if (distancex3 < 0){
            distancex3 = -distancex3;
        }
        let distancey3 = raquety3 - y;
        if (distancex3 < 7 && distancey3 < 10){
            dx = -dx;
        }
        
        //colicion con raqueta izquierda
        let distancex4 = (raquetx4) - x;
        if (distancex4 < 0){
            distancex4 = -distancex2;
        }
        let distancey4 = raquety4 - y;
        if (distancex4 < 10 && distancey4 < 10){
            dx = -dx;
        }

        

        
    }
    
    //Dibujar Texto
    function drawText() {
        ctx.fillStyle = "Red";
        ctx.fillText("Player 1  ", 120, 30);
        ctx.fillText("Player 2 ", 320, 30);
    }

    //Dibujar Letras
    function drawText2() {
        ctx.fillStyle = "blue";
        ctx.fillText(" ", 90, 295);
        ctx.fillText(" ", 395, 295);
    }

    function drawScore() {
    ctx.font = "25px Arial";
    ctx.fillStyle = "#0095DD";
    ctx.fillText("Score: "+puntosP1, 120, 60);
}

function drawScore2() {
    ctx.font = "25px Arial";
    ctx.fillStyle = "#0095DD";
    ctx.fillText("Score: "+puntosP2, 320, 60);
}

    
    function draw() {
        ctx.clearRect(0, 0, 480, 320);
        drawBall();
        drawRaquet();
        drawRaquet2();
        colitions();
        drawText();
        drawScore();
        drawScore2();
        drawText2();
        
        if (y >= 310){
            dy = dy * (-1);
        }
        if (y <= 10){
            dy = dy * (-1);
        }
        
        //Gol Jugador 1
        if (x > 480) {
            puntosP1++;
            if (puntosP1 >= maxPoints) {
                stopDrawing = true; // El juego se detiene cuando el jugador 1 alcanza el límite de puntos
                document.getElementById("winnerMessage").textContent = "¡ Won Player 1 !" ; // Se muestra el mensaje de victoria
                showFinalScore(); // Mostrar el puntaje final
            } else {
                resetBall();
            }
        }
    
        //Gol jugador 2
        if (x < 0) {
            puntosP2++;
            if (puntosP2 >= maxPoints) {
                stopDrawing = true; // El juego se detiene cuando el jugador 2 alcanza el límite de puntos
                document.getElementById("winnerMessage").textContent = "¡ Won Player 2 !" ; // Se muestra el mensaje de victoria
                showFinalScore(); // Mostrar el puntaje final
            } else {
                resetBall();
            }
        }
        
        x = x + dx;
        y = y + dy;
        
        //Teclas up y down
        if (downPressed == true){
            raquety += 2;
        }
        if (upPressed == true){
            raquety -= 2;   
        }
        
        //raqueta izquierda
        if (down2 == true){
            raquety2 -= 2;
        }
        if (up2 == true){
            raquety2 += 2;
        }
        
        if (!stopDrawing) {
            requestAnimationFrame(draw);
        }
    }
    
    function resetBall() {
        x = 240;
        y = 170;
        dx = -dx; // Invertir la dirección de la pelota al reiniciar
    }
    
    // Agregar el evento click al botón para detener el juego
    var stopButton = document.getElementById("stopButton");
    stopButton.addEventListener("click", function() {
        stopDrawing = true;
    });
    
    // Agregar el evento click al botón para reiniciar el juego
    var restartButton = document.getElementById("restartButton");
    restartButton.addEventListener("click", function() {
        resetBall();
        puntosP1 = 0;
        puntosP2 = 0;
        stopDrawing = false;
        document.getElementById("winnerMessage").textContent = "";
        document.getElementById("scoreBoard").textContent = ""; // Limpiar el puntaje final al reiniciar el juego
        draw();
    });
    
    function showFinalScore() {
        let scoreBoard = document.getElementById("scoreBoard");
        scoreBoard.textContent = "Final Score: Player 1 = " + (puntosP1) + ", Player 2 = " + (puntosP2);
    }
    
    draw();
</script>
</html>